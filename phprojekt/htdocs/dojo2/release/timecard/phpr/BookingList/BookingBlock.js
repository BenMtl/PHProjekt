//>>built
require({cache:{"url:phpr/template/bookingList/bookingBlock.html":'<div class="bookingEntry">\n    <span data-dojo-attach-point="project" class="project"></span>\n    <span data-dojo-attach-point="time"    class="time"></span>\n    <button data-dojo-type="dijit/form/Button" type="button" data-dojo-attach-point="deleteButton"\n        data-dojo-props="showLabel: false, iconClass: \'deleteIcon\', baseClass: \'deleteButton\'"\n        data-dojo-attach-event="onClick:_delete" class="deleteButton"></button>\n    <button data-dojo-type="dijit/form/Button" type="button" data-dojo-attach-point="confirmDeleteButton"\n        data-dojo-props="iconClass: \'deleteIcon\'"\n        data-dojo-attach-event="onClick:_confirmDeletion" class="confirmDeleteButton">Delete?</button>\n    <button data-dojo-type="dijit/form/Button" type="button" data-dojo-attach-point="editButton"\n        data-dojo-props="showLabel: false, iconClass: \'editIcon\', baseClass: \'editButton\'"\n        data-dojo-attach-event="onClick:_edit" class="editButton"></button>\n    <span data-dojo-attach-point="notes" class="notes"></span>\n</div>\n'}});
define("phpr/BookingList/BookingBlock","dojo/_base/declare,dojo/_base/lang,dojo/_base/window,dojo/html,dojo/on,dojo/dom-class,dojo/date,dojo/date/locale,dojo/topic,dojo/query,dojo/json,dojo/NodeList-dom,dijit/_WidgetBase,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,dojo/Evented,phpr/Timehelper,phpr/Api,dojo/text!phpr/template/bookingList/bookingBlock.html".split(","),function(l,g,m,f,h,d,n,i,j,o,p,w,q,r,s,t,k,u,v){var e=function(){o(".bookingEntry.selected, .bookingEntry.confirmDeletion").removeClass("selected confirmDeletion")};
h(m.doc,"click",e);return l([q,r,s,t],{store:null,booking:null,_actionTimeouts:null,templateString:v,constructor:function(){this._actionTimeouts={}},_setBookingAttr:function(a){u.projectTitleForId(a.projectId).then(g.hitch(this,function(a){this._destroyed||f.set(this.project,a)}));var b=k.datetimeToJsDate(a.startDatetime),c=a.endTime||"",c=""!==c,d=i.format(b,{selector:"time"})+" - ";if(c){c=k.timeToJsDate(a.endTime);c.setDate(b.getDate());c.setMonth(b.getMonth());c.setFullYear(b.getFullYear());var b=
n.difference(b,c,"minute"),e=Math.floor(b/60);f.set(this.time,d+i.format(c,{selector:"time"})+" ("+e+"h "+b%60+"m)")}else f.set(this.time,d);f.set(this.notes,a.notes)},_delete:function(){this._doClickAction("delete",function(){e();d.add(this.domNode,"confirmDeletion")})},_confirmDeletion:function(){this._doClickAction("confirm",function(){this.store.remove(this.booking.id).then(void 0,function(a){j.publish("notification",p.parse(a.responseText))}).always(function(){j.publish("timecard/bookingDeleted",
this.booking)})})},startup:function(){this.inherited(arguments);this.booking&&!0===this.booking.highlight&&d.add(this.domNode,"highlight");this.own(h(this.domNode,"click",g.hitch(this,this._markSelected)))},_markSelected:function(){this._doClickAction("select",function(){d.contains(this.domNode,"confirmDeletion")||(e(),d.add(this.domNode,"selected"))})},_edit:function(){this.emit("editClick")},_doClickAction:function(a,b){clearTimeout(this._actionTimeouts[a]);this._actionTimeouts[a]=setTimeout(g.hitch(this,
b),300)}})});